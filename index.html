<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almaster Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
</head>
<body class="bg-gray-100 p-10 font-sans">

    <div class="max-w-2xl mx-auto bg-white p-8 rounded shadow">
        <h1 class="text-2xl font-bold mb-4">وضع كشف الأخطاء (Debug Mode)</h1>
        
        <div id="status-box" class="p-4 bg-blue-100 text-blue-700 rounded mb-4">
            جاري الاتصال بقاعدة البيانات...
        </div>

        <div id="data-area" class="space-y-2"></div>
    </div>

    <script>
        // 1. إعدادات فايربيز (تأكد أن هذا الكود هو الخاص بك)
        const firebaseConfig = {
            apiKey: "AIzaSyCXyuT529aGwiS5j_RPxW_zEeAtkYc7JlM",
            authDomain: "almaster-b8c18.firebaseapp.com",
            projectId: "almaster-b8c18",
            storageBucket: "almaster-b8c18.firebasestorage.app",
            messagingSenderId: "884142036232",
            appId: "1:884142036232:web:eeb6677d988565653a08bd",
            measurementId: "G-JW3C7YCGQ8"
        };

        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            
            // محاولة جلب البيانات مع إظهار الخطأ
            const statusBox = document.getElementById('status-box');
            const dataArea = document.getElementById('data-area');

            db.collection('users').get().then((snapshot) => {
                if (snapshot.empty) {
                    statusBox.className = "p-4 bg-yellow-100 text-yellow-700 rounded";
                    statusBox.innerHTML = "✅ الاتصال نجح، ولكن <b>لا توجد بيانات موظفين</b> (Database Empty).<br>يرجى إضافة موظف جديد.";
                } else {
                    statusBox.className = "p-4 bg-green-100 text-green-700 rounded";
                    statusBox.innerHTML = `✅ الاتصال نجح! تم العثور على <b>${snapshot.size}</b> موظفين.`;
                    
                    snapshot.forEach(doc => {
                        const u = doc.data();
                        dataArea.innerHTML += `<div class="p-2 border border-gray-300 rounded bg-gray-50">
                            <b>الاسم:</b> ${u.name} <br> 
                            <b>الحالة:</b> ${u.status} <br>
                            <b>الايميل:</b> ${u.email}
                        </div>`;
                    });
                }
            }).catch((error) => {
                statusBox.className = "p-4 bg-red-100 text-red-700 rounded border border-red-400";
                statusBox.innerHTML = `❌ <b>حدث خطأ في الاتصال:</b><br>${error.message}<br><br>
                <b>الحل المقترح:</b> تأكد من تعديل الـ Rules في موقع فايربيز لتكون (allow read, write: if true).`;
            });

        } catch (e) {
            alert("خطأ في إعدادات فايربيز: " + e.message);
        }
    </script>
</body>
</html>
